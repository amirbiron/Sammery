# 🤖 בוט סיכומים שבועיים לטלגרם עם AI

בוט טלגרם חכם שמטרתו להקל על ניהול ערוצים על ידי יצירת סיכומים שבועיים אוטומטיים באמצעות GPT-4. הבוט מאזין לפוסטים חדשים בערוץ, שומר אותם במסד נתונים **MongoDB**, ומאפשר לאדמין ליצור, לתזמן ולפרסם סיכומים מקצועיים ומעניינים.

## ✨ פיצ'רים מרכזיים

- **💾 אחסון יציב ב-MongoDB:** כל הפוסטים נשמרים במסד נתונים בענן (MongoDB Atlas), מה שמבטיח שהמידע לא יאבד גם אם השרת מופעל מחדש.
- **📝 יצירת סיכומים חכמה:** שימוש במודל `gpt-4-turbo` ליצירת סיכומים קוהרנטיים, מעניינים ומותאמים לסגנון של קהל טכנולוגי.
- **🗓️ תזמון גמיש ואינטראקטיבי:** האדמין יכול לתזמן את שליחת הסיכום האוטומטי לכל שעה עגולה ביום שישי (בין 14:00 ל-19:00) באמצעות ממשק כפתורים נוח.
- **🔧 שליטה מלאה לאדמין:**
    - יצירת סיכום ידנית בכל רגע נתון.
    - תצוגה מקדימה של הסיכום לפני הפרסום.
    - אפשרות ליצור סיכום מחדש אם התוצאה לא מושלמת.
    - ניהול התזמון (הצגה וביטול).
- **📥 אכלוס נתונים ידני:** ניתן "ללמד" את הבוט על פוסטים ישנים על ידי העברתם (Forward) ישירות לבוט, והוא ישמור אותם במסד הנתונים.

## 🚀 הוראות התקנה והרצה

כדי להפעיל את הבוט, יש לבצע את השלבים הבאים:

### 1. דרישות קדם
- חשבון ב-Telegram.
- חשבון ב-GitHub.
- חשבון ב-Render (או פלטפורמת אירוח אחרת).
- חשבון ב-OpenAI עם גישה ל-API.
- חשבון ב-MongoDB Atlas.

### 2. יצירת הבוט בטלגרם
1. דבר עם [@BotFather](https://t.me/BotFather) בטלגרם.
2. השתמש בפקודה `/newbot` כדי ליצור בוט חדש.
3. שמור את ה-**Token** שהתקבל.

### 3. הקמת מסד נתונים ב-MongoDB
1. היכנס ל-[MongoDB Atlas](https://www.mongodb.com/cloud/atlas) וצור Cluster חינמי (M0).
2. לאחר שהקלאסטר מוכן, לחץ על **Connect** -> **Drivers**.
3. העתק את **מחרוזת החיבור (Connection String)**. החלף את `<password>` בסיסמה של משתמש מסד הנתונים שיצרת.

### 4. הגדרת משתני סביבה
בפלטפורמת האירוח שלך (למשל Render), הגדר את משתני הסביבה הבאים:

- `TELEGRAM_BOT_TOKEN`: הטוקן שקיבלת מ-BotFather.
- `CHANNEL_USERNAME`: שם המשתמש של הערוץ שלך (למשל, `AndroidAndAI`, ללא ה-@).
- `OPENAI_API_KEY`: מפתח ה-API שלך מ-OpenAI.
- `ADMIN_CHAT_ID`: ה-ID המספרי שלך בטלגרם. ניתן להשיג אותו על ידי שליחת הודעה ל-@[userinfobot](https://t.me/userinfobot).
- `MONGODB_URI`: מחרוזת החיבור המלאה שהעתקת מ-MongoDB Atlas.
- `DEFAULT_SCHEDULE_TIME` (אופציונלי): שעת ברירת־מחדל ליצירת תזמון אוטומטי בכל עלייה (לדוגמה `18:00`, שעון ישראל).
- `AUTO_PUBLISH_ON_START` (אופציונלי): אם `true`, יריץ את הפרסום אוטומטית לאחר יצירת הסיכום המתוזמן הקרוב.
- `SUMMARY_IMAGE_FILE_ID` (אופציונלי): `file_id` של תמונת כותרת לפרסום עם הסיכום.

### 5. הרצה על Render / Railway (Docker)
1. העלה את כל קבצי הפרויקט ל-Repository ב-GitHub.
2. ב-Render, צור **Web Service** חדש וחבר אותו ל-Repository.
3. להרצה ב-Docker, התמונה מריצה `gunicorn` על פורט `8000` ומגישה נתיב בריאות `/`. ודא שהפלטפורמה ממפה לפורט זה (ב-Railway/Render זה נעשה אוטומטית לפי `EXPOSE`).
4. הוסף את כל משתני הסביבה תחת לשונית **Environment** וודא שה-`MONGODB_URI` מוגדר.
5. לאחר פריסה ראשונה, ניתן להגדיר `DEFAULT_SCHEDULE_TIME` כדי לשחזר תזמון אוטומטי בכל עלייה, ללא צורך בפקודה ידנית.

> הערה חשובה: ריצה בסביבת Serverless (כגון Vercel Functions) אינה נתמכת לבוטי Polling של Telegram. יש להריץ כ-Service מתמשך (Render/Railway/VM/K8s).

## ⚙️ פקודות זמינות (לאדמין בלבד)

- `/generate_summary` - יוצר סיכום שבועי מהפוסטים ב-7 הימים האחרונים ומציג כפתורי ניהול (תצוגה מקדימה, פרסום, יצירה מחדש).
- `/schedule_summary` - מציג כפתורים לבחירת שעת שליחה אוטומטית לסיכום ביום שישי, או לביטול תזמון קיים.
- `/show_schedule` - מציג את פרטי התזמון האוטומטי הפעיל כרגע.
- `/preview` - מציג את הסיכום האחרון שנוצר (אם קיים).

## 💡 טיפים ושימוש מתקדם

### אכלוס היסטוריית פוסטים
כדי שהסיכום הראשון יהיה מלא, תוכל להעביר (Forward) פוסטים ישנים מהערוץ שלך ישירות לבוט בשיחה פרטית. הבוט יזהה אותם, ישמור אותם במסד הנתונים, ויאשר כל שמירה בהודעה.

### התאמת הפרומפט
ניתן לשנות את סגנון הסיכום על ידי עריכת הפרומפט בפונקציה `create_summary_with_gpt4` בקובץ `main.py`.

---
פותח באהבה ובסיוע AI.
